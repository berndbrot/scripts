#!/bin/sh
# edit a file, with sudo if current user lacks write permissions

set -e
set -u

SUDO=sudo                    # empty is false, non-empty is true
EDITOR=${EDITOR:-vi}

try_edit_as_root() {
    printf "You don't have permission to edit %s\n" "$1"
    confirm "Edit as root" && "$SUDO" "$EDITOR" "$1"
}

error() {
    printf "$*\n"
    false
}

if test $# -eq 0; then
    "$EDITOR"
else
    if test -e "$1"; then
        if test -w "$1"; then
            "$EDITOR" "$1"
        else
           try_edit_as_root "$1" || view "$1"
        fi
    else
        if test -w "$(dirname "$1")"; then
            "$EDITOR" "$1"
        else
            try_edit_as_root "$1" || error "$1 does not exist"
        fi
    fi
fi
