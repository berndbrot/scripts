#!/bin/bash
# edit a file, with sudo if current user lacks write permissions
# also turns file:line into file +line

sudo=                       # empty is false, non-empty is true
editor=${EDITOR:-vi}
args=()

if ! type confirm >/dev/null 2>&1; then
    printf "edit: confirm is not available\n" 1>&2
    exit 1
fi

if test -e "$1" && test ! -w "$1"; then
    ls -l -- "$1"
    printf "You don't have permission to edit %s\n" "$1"
    if confirm "Edit with sudo"; then
        sudo=true
    else
        printf "Canceling edit\n" 1>&2
        exit 1
    fi
fi

for arg; do
  line=${arg##*:}
  if test "$line" != "$arg"; then
    file=${arg%:$line}
    args=("$file" "+$line")
  else
    args=("$file")
  fi
done

${sudo:+sudo} "$editor" "${args[@]}"
